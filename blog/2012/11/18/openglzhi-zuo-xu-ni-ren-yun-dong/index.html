
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>OpenGL制作虚拟人运动 - 木頭人 - 宇騰</title>
	<meta name="author" content="Yutang Chung">

	
	<meta name="description" content="前言 这次的制作其实是计算机图形学的作业，也是我第一次接触OpenGL，一个星期从零开始学习OpenGL并制作虚拟人走动模型。 代码托管于GitHub的HumanWalking。 目标 虚拟的类人形模型
可以自由走动
完全使用OpenGL实现
可以控制人的走动方向
可以控制视角方向 从主函数开始 &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="木頭人 - 宇騰" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	
</head>

<body>
	<div class="container">
		<div class="left-col">
			<header id="header" class="inner"><div class="profilepic">	
	<img src="/images/dp.jpg" alt="Profile Picture" style="width: 160px;">
</div>
<h1><a href="/">木頭人 - 宇騰</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/">博客</a></li>
	<li><a href="/blog/archives">文章列表</a></li>
</ul>
</nav>
<br/>
<h3 class="alignleft">汇聚在学习中遇到的问题，感受解决问题带来的快乐</h3>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		<a class="google" href="https://plus.google.com/zonyitoo?rel=author" title="Google+">Google+</a>
		
		
		<a class="twitter" href="http://twitter.com/zonyitoo" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/Zonyitoo" title="GitHub">GitHub</a>
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>

</header>
		</div>		
		<div class="mid-col">
			
				
<div id="banner" class="inner">
	<div class="container">
		<ul class="feed"></ul>
	</div>
	<small><a href="http://twitter.com/zonyitoo">zonyitoo</a> @ <a href="http://twitter.com">Twitter</a></small>
	<div class="loading">Loading...</div>
</div>
<script src="/javascripts/twitter.js"></script>
<script type="text/javascript">
	(function($){
		$('#banner').getTwitterFeed('zonyitoo', 4, false);
	})(jQuery);
</script>

			
			<div class="mid-col-container">
				<div id="content" class="inner"><article class="post">
	<h1 class="title">OpenGL制作虚拟人运动</h1>
	<div class="entry-content"><h1>前言</h1>

<p>这次的制作其实是计算机图形学的作业，也是我第一次接触OpenGL，一个星期从零开始学习OpenGL并制作虚拟人走动模型。</p>

<p>代码托管于GitHub的<a href="https://github.com/zonyitoo/HumanWalking">HumanWalking</a>。</p>

<h2>目标</h2>

<ul>
<li>虚拟的类人形模型</li>
<li>可以自由走动</li>
<li>完全使用OpenGL实现</li>
<li>可以控制人的走动方向</li>
<li>可以控制视角方向</li>
</ul>


<h1>从主函数开始</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">glutInit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
</span><span class='line'>    <span class="n">glutInitDisplayMode</span><span class="p">(</span><span class="n">GLUT_DOUBLE</span> <span class="o">|</span> <span class="n">GLUT_RGB</span> <span class="o">|</span> <span class="n">GLUT_DEPTH</span><span class="p">);</span>
</span><span class='line'>    <span class="n">glutInitWindowSize</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">500</span><span class="p">);</span>
</span><span class='line'>    <span class="n">glutInitWindowPosition</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
</span><span class='line'>    <span class="n">glutCreateWindow</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span><span class='line'>    <span class="n">init</span><span class="p">();</span>
</span><span class='line'>    <span class="n">glutDisplayFunc</span><span class="p">(</span><span class="n">display</span><span class="p">);</span>
</span><span class='line'>    <span class="n">glutReshapeFunc</span><span class="p">(</span><span class="n">reshape</span><span class="p">);</span>
</span><span class='line'>    <span class="n">glutKeyboardFunc</span><span class="p">(</span><span class="n">keyboard</span><span class="p">);</span>
</span><span class='line'>    <span class="n">glutPassiveMotionFunc</span><span class="p">(</span><span class="n">passiveMotionFunc</span><span class="p">);</span>
</span><span class='line'>    <span class="n">calculateData</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="n">glutMainLoop</span><span class="p">();</span>
</span><span class='line'>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>先调用<code>glutInit</code>函数初始化OpenGL环境</p></li>
<li><p>设定OpenGL的显示模式，在这里启动了<code>GLUT_DOUBLE</code>双缓冲、<code>GLUT_RGB</code>RGB显示模式（区分于颜色索引模式）、<code>GLUT_DEPTH</code>深度模式（三维）。</p></li>
<li><p>设置GLUT显示窗口大小，这里是500*500像素</p></li>
<li><p>设置GLUT初始显示位置（窗口左上角位置）：(x,y)=(100,100)</p></li>
<li><p>调用<code>glutCreateWindow</code>来创建窗口，传入参数为窗口的名字，但此时窗口并不会显示，直到调用<code>glutMainLoop</code>才会显示</p></li>
<li><p>调用<code>init</code>函数来做一些初始化工作</p></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="kt">void</span> <span class="n">init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">glClearColor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span> <span class="c1">// 用黑色清空屏幕</span>
</span><span class='line'>    <span class="n">glShadeModel</span><span class="p">(</span><span class="n">GL_FLAT</span><span class="p">);</span>  <span class="c1">// 设置着色模型，GL_FLAT为单调着色模式，默认为GL_SMOOTH平滑着色</span>
</span><span class='line'>    <span class="n">glEnable</span><span class="p">(</span><span class="n">GL_DEPTH_TEST</span><span class="p">);</span> <span class="c1">// 打开深度测试，即显示图像时有不同深度的物体的遮挡效果，默认为后显示的遮挡先显示的</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">quadratic</span> <span class="o">=</span> <span class="n">gluNewQuadric</span><span class="p">();</span> <span class="c1">// 新建一个二次对象，用来画圆柱体</span>
</span><span class='line'>    <span class="n">gluQuadricNormals</span><span class="p">(</span><span class="n">quadratic</span><span class="p">,</span> <span class="n">GLU_SMOOTH</span><span class="p">);</span> <span class="c1">// 指定二次对象的法向量类型</span>
</span><span class='line'>    <span class="n">gluQuadricTexture</span><span class="p">(</span><span class="n">quadratic</span><span class="p">,</span> <span class="n">GL_TRUE</span><span class="p">);</span> <span class="c1">// 打开纹理显示</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">lastClock</span> <span class="o">=</span> <span class="n">clock</span><span class="p">();</span> <span class="c1">// 记录当前的clock，用于计算FPS</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>调用<code>glutDisplayFunc</code>设置显示响应函数<code>display</code>，这个稍后叙述。</p></li>
<li><p>调用<code>glutReshapeFunc</code>设置在窗口大小改变时的响应函数<code>reshape</code></p></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="kt">void</span> <span class="n">reshape</span><span class="p">(</span><span class="kt">int</span> <span class="n">w</span><span class="p">,</span> <span class="kt">int</span> <span class="n">h</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">scrw</span> <span class="o">=</span> <span class="n">w</span><span class="p">;</span> <span class="c1">// 全局变量，记录当前的屏幕宽度</span>
</span><span class='line'>    <span class="n">scrh</span> <span class="o">=</span> <span class="n">h</span><span class="p">;</span> <span class="c1">// 全局变量，记录当前的屏幕高度</span>
</span><span class='line'>    <span class="n">glViewport</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">GLsizei</span><span class="p">)</span> <span class="n">w</span><span class="p">,</span> <span class="p">(</span><span class="n">GLsizei</span><span class="p">)</span> <span class="n">h</span><span class="p">);</span> <span class="c1">// 设置显示区域大小</span>
</span><span class='line'>    <span class="n">glMatrixMode</span><span class="p">(</span><span class="n">GL_PROJECTION</span><span class="p">);</span> <span class="c1">// 把「投影矩阵」设置为当前矩阵</span>
</span><span class='line'>    <span class="n">glLoadIdentity</span><span class="p">();</span> <span class="c1">// 把矩阵设成单位矩阵</span>
</span><span class='line'>    <span class="n">gluPerspective</span><span class="p">(</span><span class="mf">60.0</span><span class="p">,</span> <span class="p">(</span><span class="n">GLfloat</span><span class="p">)</span> <span class="n">w</span> <span class="o">/</span> <span class="p">(</span><span class="n">GLfloat</span><span class="p">)</span> <span class="n">h</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">);</span> <span class="c1">// 设置Perspective</span>
</span><span class='line'>    <span class="n">glMatrixMode</span><span class="p">(</span><span class="n">GL_MODELVIEW</span><span class="p">);</span> <span class="c1">// 把「模型视景矩阵」设置为当前矩阵</span>
</span><span class='line'>    <span class="n">glLoadIdentity</span><span class="p">();</span> <span class="c1">// 把矩阵设成单位矩阵</span>
</span><span class='line'>    <span class="n">gluLookAt</span><span class="p">(</span><span class="n">lookatx</span><span class="p">,</span> <span class="n">lookaty</span><span class="p">,</span> <span class="n">lookatz</span><span class="p">,</span> <span class="n">centerX</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">centerZ</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span> <span class="c1">// 改变视角</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>调用<code>glutKeyboardFunc</code>设置键盘按键响应函数<code>keyboard</code></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="kt">void</span> <span class="n">keyboard</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">key</span><span class="p">,</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">switch</span> <span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// 此处vangle为人的速度方向与x轴负方向的夹角</span>
</span><span class='line'>        <span class="k">case</span> <span class="sc">&#39;a&#39;</span><span class="o">:</span>
</span><span class='line'>            <span class="n">vangle</span> <span class="o">=</span> <span class="p">(</span><span class="n">vangle</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">;</span>
</span><span class='line'>            <span class="k">break</span><span class="p">;</span>
</span><span class='line'>        <span class="k">case</span> <span class="sc">&#39;d&#39;</span><span class="o">:</span>
</span><span class='line'>            <span class="n">vangle</span> <span class="o">=</span> <span class="p">(</span><span class="n">vangle</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">;</span>
</span><span class='line'>            <span class="k">break</span><span class="p">;</span>
</span><span class='line'>        <span class="k">case</span> <span class="mi">27</span><span class="o">:</span>
</span><span class='line'>            <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'>        <span class="k">case</span> <span class="sc">&#39;s&#39;</span><span class="o">:</span>
</span><span class='line'>            <span class="n">vangle</span> <span class="o">=</span> <span class="p">(</span><span class="n">vangle</span> <span class="o">+</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">;</span>
</span><span class='line'>            <span class="k">break</span><span class="p">;</span>
</span><span class='line'>        <span class="k">default</span><span class="o">:</span>
</span><span class='line'>            <span class="k">break</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>调用<code>glutPassiveMotionFunc</code>设置鼠标在界面上移动时的响应函数<code>passiveMotionFunc</code></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="kt">void</span> <span class="n">passiveMotionFunc</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// 把视角限定在以人的胯部（坐标原点）为中心的半径为5.0的球面上</span>
</span><span class='line'>    <span class="n">lookatx</span> <span class="o">=</span> <span class="o">-</span><span class="mf">5.0</span> <span class="o">+</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span> <span class="n">x</span> <span class="o">/</span> <span class="n">scrw</span> <span class="o">*</span> <span class="mf">10.0</span><span class="p">;</span>
</span><span class='line'>    <span class="n">lookatz</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">25</span> <span class="o">-</span> <span class="n">lookatx</span> <span class="o">*</span> <span class="n">lookatx</span><span class="p">)</span> <span class="o">+</span> <span class="n">centerZ</span><span class="p">;</span>
</span><span class='line'>    <span class="n">lookatx</span> <span class="o">+=</span> <span class="n">centerX</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">double</span> <span class="n">tmpy</span> <span class="o">=</span> <span class="o">-</span><span class="mf">5.0</span> <span class="o">+</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span> <span class="n">y</span> <span class="o">/</span> <span class="n">scrh</span> <span class="o">*</span> <span class="mf">10.0</span><span class="p">;</span>
</span><span class='line'>    <span class="c1">// 不可以低于地面</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">tmpy</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">LEG_XSCALE</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
</span><span class='line'>        <span class="n">lookaty</span> <span class="o">=</span> <span class="n">tmpy</span><span class="p">;</span>
</span><span class='line'>    <span class="n">glLoadIdentity</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">gluLookAt</span><span class="p">(</span><span class="n">lookatx</span><span class="p">,</span> <span class="n">lookaty</span><span class="p">,</span> <span class="n">lookatz</span><span class="p">,</span> <span class="n">centerX</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">centerZ</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>调用<code>calculateData</code>计算数据并显示，稍后叙述</p></li>
<li><p>最后调用<code>glutMainLoop</code>进入OpenGL事件循环，窗口开始显示动画，开始接受鼠标、键盘输入事件</p></li>
</ul>


<h2>定义的全局变量</h2>

<p>其中的赋值为其初值</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="k">static</span> <span class="kt">int</span> <span class="n">leftHigherLegAngle</span> <span class="o">=</span> <span class="o">-</span><span class="mi">60</span><span class="p">,</span> <span class="n">rightHigherLegAngle</span> <span class="o">=</span> <span class="o">-</span><span class="mi">120</span><span class="p">;</span> <span class="c1">// 大腿</span>
</span><span class='line'><span class="k">static</span> <span class="kt">int</span> <span class="n">leftLowerLegAngle</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">rightLowerLegAngle</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// 小腿</span>
</span><span class='line'><span class="k">static</span> <span class="kt">int</span> <span class="n">leftHigherHandAngle</span> <span class="o">=</span> <span class="o">-</span><span class="mi">120</span><span class="p">,</span> <span class="n">rightHigherHandAngle</span> <span class="o">=</span> <span class="o">-</span><span class="mi">60</span><span class="p">;</span> <span class="c1">// 手臂上半部</span>
</span><span class='line'><span class="k">static</span> <span class="kt">int</span> <span class="n">leftLowerHandAngle</span> <span class="o">=</span> <span class="o">-</span><span class="mi">60</span><span class="p">,</span> <span class="n">rightLowerHandAngle</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// 手臂下半部</span>
</span><span class='line'><span class="k">static</span> <span class="kt">int</span> <span class="n">leftFootAngle</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">rightFootAngle</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// 脚掌</span>
</span><span class='line'>
</span><span class='line'><span class="k">static</span> <span class="n">GLfloat</span> <span class="n">centerX</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">centerY</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">centerZ</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span> <span class="c1">// 胯部坐标（人的中心）</span>
</span><span class='line'><span class="k">static</span> <span class="n">GLint</span> <span class="n">vangle</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// 人的前进速度方向与x轴负方向的夹角</span>
</span><span class='line'>
</span><span class='line'><span class="k">static</span> <span class="n">clock_t</span> <span class="n">lastClock</span><span class="p">;</span> <span class="c1">// 记录的clock，用于计算FPS</span>
</span></code></pre></td></tr></table></div></figure>


<h2>calculateData函数，计算关节角度</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="kt">void</span> <span class="n">calculateData</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// 使人的胯部离地面的距离随着动作的改变而改变</span>
</span><span class='line'>    <span class="n">centerY</span> <span class="o">=</span> <span class="n">legLength</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="o">-</span><span class="n">leftHigherLegAngle</span> <span class="o">/</span> <span class="mf">180.0</span> <span class="o">*</span> <span class="n">PI</span><span class="p">)</span> <span class="o">-</span> <span class="n">legLength</span><span class="p">;</span>
</span><span class='line'>    <span class="c1">// 为了简化计算，我粗略假定大腿每动1度，人会朝着其方向前进0.035个单位长度</span>
</span><span class='line'>    <span class="kt">double</span> <span class="n">mvx</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">vangle</span> <span class="o">/</span> <span class="mf">180.0</span> <span class="o">*</span> <span class="n">PI</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.035</span><span class="p">;</span> <span class="c1">// 计算x轴方向移动的距离</span>
</span><span class='line'>    <span class="kt">double</span> <span class="n">mvz</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">vangle</span> <span class="o">/</span> <span class="mf">180.0</span> <span class="o">*</span> <span class="n">PI</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.035</span><span class="p">;</span> <span class="c1">// 计算z轴方向移动的距离</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// dir1为全局变量，为true时右脚向前，为false时左脚向前</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dir1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">leftHigherLegAngle</span> <span class="o">--</span><span class="p">;</span>  <span class="c1">// 左脚向前运动</span>
</span><span class='line'>        <span class="n">rightHigherLegAngle</span> <span class="o">++</span><span class="p">;</span> <span class="c1">// 右脚向后运动</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">leftHigherLegAngle</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mi">75</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="c1">// 若左腿的角度已经大于-75，那么左脚小腿向上翘起</span>
</span><span class='line'>            <span class="n">leftLowerLegAngle</span> <span class="o">+=</span> <span class="mi">6</span><span class="p">;</span>
</span><span class='line'>            <span class="n">leftFootAngle</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="c1">// 若左脚角度小于-105，那么左腿小腿向前踢</span>
</span><span class='line'>        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">leftHigherLegAngle</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">105</span><span class="p">)</span> <span class="n">leftLowerLegAngle</span> <span class="o">-=</span> <span class="mi">6</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// 若已经达到-120度（大腿的运动范围为[-120, -60]）</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">leftHigherLegAngle</span> <span class="o">==</span> <span class="o">-</span><span class="mi">120</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">dir1</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// 此时右脚着地，计算右脚脚掌的角度，始终贴着地面</span>
</span><span class='line'>        <span class="n">rightFootAngle</span> <span class="o">=</span> <span class="o">-</span><span class="n">rightHigherLegAngle</span> <span class="o">-</span> <span class="mi">90</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// 手部简单地匀速运动，运动范围为60度</span>
</span><span class='line'>        <span class="n">leftHigherHandAngle</span> <span class="o">++</span><span class="p">;</span>
</span><span class='line'>        <span class="n">leftLowerHandAngle</span> <span class="o">++</span><span class="p">;</span>
</span><span class='line'>        <span class="n">rightHigherHandAngle</span> <span class="o">--</span><span class="p">;</span>
</span><span class='line'>        <span class="n">rightLowerHandAngle</span> <span class="o">--</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">leftHigherLegAngle</span> <span class="o">++</span><span class="p">;</span>
</span><span class='line'>        <span class="n">rightHigherLegAngle</span> <span class="o">--</span><span class="p">;</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">rightHigherLegAngle</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mi">75</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">rightLowerLegAngle</span> <span class="o">+=</span> <span class="mi">6</span><span class="p">;</span>
</span><span class='line'>            <span class="n">rightFootAngle</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">rightHigherLegAngle</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">105</span><span class="p">)</span> <span class="n">rightLowerLegAngle</span> <span class="o">-=</span> <span class="mi">6</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">leftHigherLegAngle</span> <span class="o">==</span> <span class="o">-</span><span class="mi">60</span><span class="p">)</span> <span class="n">dir1</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">leftFootAngle</span> <span class="o">=</span> <span class="o">-</span><span class="n">leftHigherLegAngle</span> <span class="o">-</span> <span class="mi">90</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">leftHigherHandAngle</span> <span class="o">--</span><span class="p">;</span>
</span><span class='line'>        <span class="n">leftLowerHandAngle</span> <span class="o">--</span><span class="p">;</span>
</span><span class='line'>        <span class="n">rightHigherHandAngle</span> <span class="o">++</span><span class="p">;</span>
</span><span class='line'>        <span class="n">rightLowerHandAngle</span> <span class="o">++</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// 人移动</span>
</span><span class='line'>    <span class="n">centerX</span> <span class="o">-=</span> <span class="n">mvx</span><span class="p">;</span>
</span><span class='line'>    <span class="n">lookatx</span> <span class="o">-=</span> <span class="n">mvx</span><span class="p">;</span>
</span><span class='line'>    <span class="n">centerZ</span> <span class="o">+=</span> <span class="n">mvz</span><span class="p">;</span>
</span><span class='line'>    <span class="n">lookatz</span> <span class="o">+=</span> <span class="n">mvz</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// 调整视角，始终把屏幕中心对准人的中心</span>
</span><span class='line'>    <span class="n">glLoadIdentity</span><span class="p">();</span>
</span><span class='line'>    <span class="n">gluLookAt</span><span class="p">(</span><span class="n">lookatx</span><span class="p">,</span> <span class="n">lookaty</span><span class="p">,</span> <span class="n">lookatz</span><span class="p">,</span> <span class="n">centerX</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">centerZ</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// 刷新屏幕</span>
</span><span class='line'>    <span class="n">glutPostRedisplay</span><span class="p">();</span>
</span><span class='line'>    <span class="c1">// 设置定时器函数，1毫秒后再重新调用calculateData</span>
</span><span class='line'>    <span class="n">glutTimerFunc</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">calculateData</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>宏定义的常量</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="cp">#define GLOBAL_SIZE 0.5              </span><span class="c1">// 全局缩放比例</span>
</span><span class='line'><span class="cp">// 绘制脚部长方体所需的坐标系缩放比例</span>
</span><span class='line'><span class="cp">#define LEG_XSCALE 2.0</span>
</span><span class='line'><span class="cp">#define LEG_YSCALE 0.4</span>
</span><span class='line'><span class="cp">#define LEG_ZSCALE 0.4</span>
</span><span class='line'><span class="cp">// 身体的长方体</span>
</span><span class='line'><span class="cp">#define BODY_XSCALE 0.5</span>
</span><span class='line'><span class="cp">#define BODY_YSCALE LEG_XSCALE * 1.2</span>
</span><span class='line'><span class="cp">#define BODY_ZSCALE 1.5</span>
</span><span class='line'><span class="cp">// 头部的半径为身体的厚度</span>
</span><span class='line'><span class="cp">#define HEAD_RADIUS GLOBAL_SIZE * BODY_XSCALE</span>
</span><span class='line'><span class="cp">// 手臂的长方体</span>
</span><span class='line'><span class="cp">#define HAND_XSCALE 1.6</span>
</span><span class='line'><span class="cp">#define HAND_YSCALE LEG_YSCALE</span>
</span><span class='line'><span class="cp">#define HAND_ZSCALE LEG_ZSCALE</span>
</span><span class='line'><span class="cp">// 脚掌的长方体</span>
</span><span class='line'><span class="cp">#define FOOT_XSCALE 1.0</span>
</span><span class='line'><span class="cp">#define FOOT_YSCALE 0.3</span>
</span><span class='line'><span class="cp">#define FOOT_ZSCALE LEG_ZSCALE</span>
</span></code></pre></td></tr></table></div></figure>


<h2>display函数，画出虚拟人模型</h2>

<p>这个函数是根据<code>calculateData</code>函数计算出的值来重画整个屏幕。Talk is less.
这里面的<code>glPushMatrix</code>函数可能用得不好，有些冗余，原因是我在做这个作业的时候代码是一点点增加的，先是只有一只脚，然后两只脚，然后加个身……</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="kt">void</span> <span class="n">display</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">calFPS</span><span class="p">();</span> <span class="c1">// 计算FPS</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">glClear</span><span class="p">(</span><span class="n">GL_COLOR_BUFFER_BIT</span> <span class="o">|</span> <span class="n">GL_DEPTH_BUFFER_BIT</span><span class="p">);</span> <span class="c1">// 清空颜色缓冲和深度缓冲</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">glColor3f</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">);</span> <span class="c1">// 设置颜色为深灰色</span>
</span><span class='line'>    <span class="c1">// 画地面，以当前人的位置，前后纵横各画30条线段，整个平面为正方形</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">minx</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">centerX</span> <span class="o">-</span> <span class="mi">30</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">maxx</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">centerX</span> <span class="o">+</span> <span class="mi">30</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">minz</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">centerZ</span> <span class="o">-</span> <span class="mi">30</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">maxz</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">centerZ</span> <span class="o">+</span> <span class="mi">30</span><span class="p">;</span>
</span><span class='line'>    <span class="c1">// 画竖线</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">minx</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">maxx</span><span class="p">;</span> <span class="o">++</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">glBegin</span><span class="p">(</span><span class="n">GL_LINES</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glVertex3f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">LEG_XSCALE</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">FOOT_YSCALE</span><span class="p">,</span> <span class="n">minz</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glVertex3f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">LEG_XSCALE</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">FOOT_YSCALE</span><span class="p">,</span> <span class="n">maxz</span><span class="p">);</span>
</span><span class='line'>        <span class="n">glEnd</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="c1">// 画横线</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">z</span> <span class="o">=</span> <span class="n">minz</span><span class="p">;</span> <span class="n">z</span> <span class="o">&lt;=</span> <span class="n">maxz</span><span class="p">;</span> <span class="o">++</span> <span class="n">z</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">glBegin</span><span class="p">(</span><span class="n">GL_LINES</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glVertex3f</span><span class="p">(</span><span class="n">minx</span><span class="p">,</span> <span class="o">-</span><span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">LEG_XSCALE</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">FOOT_YSCALE</span><span class="p">,</span> <span class="n">z</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glVertex3f</span><span class="p">(</span><span class="n">maxx</span><span class="p">,</span> <span class="o">-</span><span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">LEG_XSCALE</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">FOOT_YSCALE</span><span class="p">,</span> <span class="n">z</span><span class="p">);</span>
</span><span class='line'>        <span class="n">glEnd</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">glPushMatrix</span><span class="p">();</span>
</span><span class='line'>        <span class="n">glTranslatef</span><span class="p">(</span><span class="n">centerX</span><span class="p">,</span> <span class="n">centerY</span><span class="p">,</span> <span class="n">centerZ</span><span class="p">);</span> <span class="c1">// 把坐标系原点移到当前人的中心所在位置</span>
</span><span class='line'>        <span class="n">glRotatef</span><span class="p">(</span><span class="n">vangle</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span> <span class="c1">// 旋转vangle角度，使人对着其前进方向</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">glColor3f</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">);</span> <span class="c1">// 设置颜色为灰色</span>
</span><span class='line'>        <span class="c1">// 画左脚</span>
</span><span class='line'>        <span class="n">glPushMatrix</span><span class="p">();</span>
</span><span class='line'>            <span class="n">glRotatef</span><span class="p">((</span><span class="n">GLfloat</span><span class="p">)</span> <span class="n">leftHigherLegAngle</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glTranslatef</span><span class="p">(</span><span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">LEG_XSCALE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">LEG_ZSCALE</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glPushMatrix</span><span class="p">();</span>
</span><span class='line'>                <span class="n">glScalef</span><span class="p">(</span><span class="n">LEG_XSCALE</span><span class="p">,</span> <span class="n">LEG_YSCALE</span><span class="p">,</span> <span class="n">LEG_ZSCALE</span><span class="p">);</span>
</span><span class='line'>                <span class="n">glutSolidCube</span><span class="p">(</span><span class="n">GLOBAL_SIZE</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glPopMatrix</span><span class="p">();</span>
</span><span class='line'>            <span class="n">glTranslatef</span><span class="p">(</span><span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">LEG_XSCALE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
</span><span class='line'>            <span class="c1">// 画关节</span>
</span><span class='line'>            <span class="n">glPushMatrix</span><span class="p">();</span>
</span><span class='line'>                <span class="n">glTranslatef</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">LEG_ZSCALE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
</span><span class='line'>                <span class="n">gluCylinder</span><span class="p">(</span><span class="n">quadratic</span><span class="p">,</span> <span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">LEG_YSCALE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
</span><span class='line'>                      <span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">LEG_YSCALE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">LEG_ZSCALE</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">);</span>
</span><span class='line'>                <span class="n">glTranslatef</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">LEG_ZSCALE</span><span class="p">);</span>
</span><span class='line'>                <span class="n">drawSolidCircle</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">LEG_YSCALE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
</span><span class='line'>                <span class="n">glTranslatef</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">LEG_ZSCALE</span><span class="p">);</span>
</span><span class='line'>                <span class="n">drawSolidCircle</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">LEG_YSCALE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glPopMatrix</span><span class="p">();</span>
</span><span class='line'>            <span class="n">glRotatef</span><span class="p">((</span><span class="n">GLfloat</span><span class="p">)</span> <span class="n">leftLowerLegAngle</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glTranslatef</span><span class="p">(</span><span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">LEG_XSCALE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glPushMatrix</span><span class="p">();</span>
</span><span class='line'>                <span class="n">glScalef</span><span class="p">(</span><span class="n">LEG_XSCALE</span><span class="p">,</span> <span class="n">LEG_YSCALE</span><span class="p">,</span> <span class="n">LEG_ZSCALE</span><span class="p">);</span>
</span><span class='line'>                <span class="n">glutSolidCube</span><span class="p">(</span><span class="n">GLOBAL_SIZE</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glPopMatrix</span><span class="p">();</span>
</span><span class='line'>            <span class="c1">// 画脚掌</span>
</span><span class='line'>            <span class="n">glTranslatef</span><span class="p">(</span><span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">LEG_XSCALE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glRotatef</span><span class="p">(</span><span class="mf">90.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glTranslatef</span><span class="p">(</span><span class="o">-</span><span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">FOOT_XSCALE</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">LEG_YSCALE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glRotatef</span><span class="p">((</span><span class="n">GLfloat</span><span class="p">)</span> <span class="n">leftFootAngle</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glPushMatrix</span><span class="p">();</span>
</span><span class='line'>                <span class="n">glScalef</span><span class="p">(</span><span class="n">FOOT_XSCALE</span><span class="p">,</span> <span class="n">FOOT_YSCALE</span><span class="p">,</span> <span class="n">FOOT_ZSCALE</span><span class="p">);</span>
</span><span class='line'>                <span class="n">glutSolidCube</span><span class="p">(</span><span class="n">GLOBAL_SIZE</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glPopMatrix</span><span class="p">();</span>
</span><span class='line'>        <span class="n">glPopMatrix</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// 同理画右脚</span>
</span><span class='line'>        <span class="n">glPushMatrix</span><span class="p">();</span>
</span><span class='line'>            <span class="n">glRotatef</span><span class="p">((</span><span class="n">GLfloat</span><span class="p">)</span> <span class="n">rightHigherLegAngle</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glTranslatef</span><span class="p">(</span><span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">LEG_XSCALE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">LEG_ZSCALE</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glPushMatrix</span><span class="p">();</span>
</span><span class='line'>                <span class="n">glScalef</span><span class="p">(</span><span class="n">LEG_XSCALE</span><span class="p">,</span> <span class="n">LEG_YSCALE</span><span class="p">,</span> <span class="n">LEG_ZSCALE</span><span class="p">);</span>
</span><span class='line'>                <span class="n">glutSolidCube</span><span class="p">(</span><span class="n">GLOBAL_SIZE</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glPopMatrix</span><span class="p">();</span>
</span><span class='line'>            <span class="n">glTranslatef</span><span class="p">(</span><span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">LEG_XSCALE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
</span><span class='line'>            <span class="c1">// 关节</span>
</span><span class='line'>            <span class="n">glPushMatrix</span><span class="p">();</span>
</span><span class='line'>                <span class="n">glTranslatef</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">LEG_ZSCALE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
</span><span class='line'>                <span class="n">gluCylinder</span><span class="p">(</span><span class="n">quadratic</span><span class="p">,</span> <span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">LEG_YSCALE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
</span><span class='line'>                      <span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">LEG_YSCALE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">LEG_ZSCALE</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">);</span>
</span><span class='line'>                <span class="n">glTranslatef</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">LEG_ZSCALE</span><span class="p">);</span>
</span><span class='line'>                <span class="n">drawSolidCircle</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">LEG_YSCALE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
</span><span class='line'>                <span class="n">glTranslatef</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">LEG_ZSCALE</span><span class="p">);</span>
</span><span class='line'>                <span class="n">drawSolidCircle</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">LEG_YSCALE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glPopMatrix</span><span class="p">();</span>
</span><span class='line'>            <span class="n">glRotatef</span><span class="p">((</span><span class="n">GLfloat</span><span class="p">)</span> <span class="n">rightLowerLegAngle</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glTranslatef</span><span class="p">(</span><span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">LEG_XSCALE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glPushMatrix</span><span class="p">();</span>
</span><span class='line'>                <span class="n">glScalef</span><span class="p">(</span><span class="n">LEG_XSCALE</span><span class="p">,</span> <span class="n">LEG_YSCALE</span><span class="p">,</span> <span class="n">LEG_ZSCALE</span><span class="p">);</span>
</span><span class='line'>                <span class="n">glutSolidCube</span><span class="p">(</span><span class="n">GLOBAL_SIZE</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glPopMatrix</span><span class="p">();</span>
</span><span class='line'>            <span class="c1">// 脚掌</span>
</span><span class='line'>            <span class="n">glTranslatef</span><span class="p">(</span><span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">LEG_XSCALE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glRotatef</span><span class="p">(</span><span class="mf">90.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glTranslatef</span><span class="p">(</span><span class="o">-</span><span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">FOOT_XSCALE</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">LEG_YSCALE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glRotatef</span><span class="p">((</span><span class="n">GLfloat</span><span class="p">)</span> <span class="n">rightFootAngle</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glPushMatrix</span><span class="p">();</span>
</span><span class='line'>                <span class="n">glScalef</span><span class="p">(</span><span class="n">FOOT_XSCALE</span><span class="p">,</span> <span class="n">FOOT_YSCALE</span><span class="p">,</span> <span class="n">FOOT_ZSCALE</span><span class="p">);</span>
</span><span class='line'>                <span class="n">glutSolidCube</span><span class="p">(</span><span class="n">GLOBAL_SIZE</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glPopMatrix</span><span class="p">();</span>
</span><span class='line'>        <span class="n">glPopMatrix</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// 身体</span>
</span><span class='line'>        <span class="n">glColor3f</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span> <span class="c1">// 头和身颜色为白色</span>
</span><span class='line'>        <span class="n">glPushMatrix</span><span class="p">();</span>
</span><span class='line'>            <span class="n">glTranslatef</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">BODY_YSCALE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glScalef</span><span class="p">(</span><span class="n">BODY_XSCALE</span><span class="p">,</span> <span class="n">BODY_YSCALE</span><span class="p">,</span> <span class="n">BODY_ZSCALE</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glutSolidCube</span><span class="p">(</span><span class="n">GLOBAL_SIZE</span><span class="p">);</span>
</span><span class='line'>        <span class="n">glPopMatrix</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// 头部</span>
</span><span class='line'>        <span class="n">glPushMatrix</span><span class="p">();</span>
</span><span class='line'>            <span class="n">glTranslatef</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">BODY_YSCALE</span> <span class="o">+</span> <span class="n">HEAD_RADIUS</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glutSolidSphere</span><span class="p">(</span><span class="n">HEAD_RADIUS</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
</span><span class='line'>        <span class="n">glPopMatrix</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// 左手</span>
</span><span class='line'>        <span class="n">glColor3f</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">);</span> <span class="c1">// 颜色为灰色</span>
</span><span class='line'>        <span class="n">glPushMatrix</span><span class="p">();</span>
</span><span class='line'>            <span class="n">glTranslatef</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">BODY_YSCALE</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glRotatef</span><span class="p">((</span><span class="n">GLfloat</span><span class="p">)</span> <span class="n">leftHigherHandAngle</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glTranslatef</span><span class="p">(</span><span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">HAND_XSCALE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span class='line'>                  <span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="p">(</span><span class="n">BODY_ZSCALE</span> <span class="o">+</span> <span class="n">HAND_ZSCALE</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glPushMatrix</span><span class="p">();</span>
</span><span class='line'>                <span class="n">glScalef</span><span class="p">(</span><span class="n">HAND_XSCALE</span><span class="p">,</span> <span class="n">HAND_YSCALE</span><span class="p">,</span> <span class="n">HAND_ZSCALE</span><span class="p">);</span>
</span><span class='line'>                <span class="n">glutSolidCube</span><span class="p">(</span><span class="n">GLOBAL_SIZE</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glPopMatrix</span><span class="p">();</span>
</span><span class='line'>            <span class="n">glTranslatef</span><span class="p">(</span><span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">HAND_XSCALE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
</span><span class='line'>            <span class="c1">// 关节</span>
</span><span class='line'>            <span class="n">glPushMatrix</span><span class="p">();</span>
</span><span class='line'>                <span class="n">glTranslatef</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">HAND_ZSCALE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
</span><span class='line'>                <span class="n">gluCylinder</span><span class="p">(</span><span class="n">quadratic</span><span class="p">,</span> <span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">HAND_YSCALE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
</span><span class='line'>                      <span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">HAND_YSCALE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">HAND_ZSCALE</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">);</span>
</span><span class='line'>                <span class="n">glTranslatef</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">HAND_ZSCALE</span><span class="p">);</span>
</span><span class='line'>                <span class="n">drawSolidCircle</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">HAND_YSCALE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
</span><span class='line'>                <span class="n">glTranslatef</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">HAND_ZSCALE</span><span class="p">);</span>
</span><span class='line'>                <span class="n">drawSolidCircle</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">HAND_YSCALE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glPopMatrix</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">glRotatef</span><span class="p">((</span><span class="n">GLfloat</span><span class="p">)</span> <span class="n">leftLowerHandAngle</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glTranslatef</span><span class="p">(</span><span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">HAND_XSCALE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glPushMatrix</span><span class="p">();</span>
</span><span class='line'>                <span class="n">glScalef</span><span class="p">(</span><span class="n">HAND_XSCALE</span><span class="p">,</span> <span class="n">HAND_YSCALE</span><span class="p">,</span> <span class="n">HAND_ZSCALE</span><span class="p">);</span>
</span><span class='line'>                <span class="n">glutSolidCube</span><span class="p">(</span><span class="n">GLOBAL_SIZE</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glPopMatrix</span><span class="p">();</span>
</span><span class='line'>        <span class="n">glPopMatrix</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// 同理画右手</span>
</span><span class='line'>        <span class="n">glPushMatrix</span><span class="p">();</span>
</span><span class='line'>            <span class="n">glTranslatef</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">BODY_YSCALE</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glRotatef</span><span class="p">((</span><span class="n">GLfloat</span><span class="p">)</span> <span class="n">rightHigherHandAngle</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glTranslatef</span><span class="p">(</span><span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">HAND_XSCALE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span class='line'>                   <span class="o">-</span><span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="p">(</span><span class="n">BODY_ZSCALE</span> <span class="o">+</span> <span class="n">HAND_ZSCALE</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glPushMatrix</span><span class="p">();</span>
</span><span class='line'>                <span class="n">glScalef</span><span class="p">(</span><span class="n">HAND_XSCALE</span><span class="p">,</span> <span class="n">HAND_YSCALE</span><span class="p">,</span> <span class="n">HAND_ZSCALE</span><span class="p">);</span>
</span><span class='line'>                <span class="n">glutSolidCube</span><span class="p">(</span><span class="n">GLOBAL_SIZE</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glPopMatrix</span><span class="p">();</span>
</span><span class='line'>            <span class="n">glTranslatef</span><span class="p">(</span><span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">HAND_XSCALE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
</span><span class='line'>            <span class="c1">// Joint</span>
</span><span class='line'>            <span class="n">glPushMatrix</span><span class="p">();</span>
</span><span class='line'>                <span class="n">glTranslatef</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">HAND_ZSCALE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
</span><span class='line'>                <span class="n">gluCylinder</span><span class="p">(</span><span class="n">quadratic</span><span class="p">,</span> <span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">HAND_YSCALE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
</span><span class='line'>                      <span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">HAND_YSCALE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">HAND_ZSCALE</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">);</span>
</span><span class='line'>                <span class="n">glTranslatef</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">HAND_ZSCALE</span><span class="p">);</span>
</span><span class='line'>                <span class="n">drawSolidCircle</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">HAND_YSCALE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
</span><span class='line'>                <span class="n">glTranslatef</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">HAND_ZSCALE</span><span class="p">);</span>
</span><span class='line'>                <span class="n">drawSolidCircle</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">HAND_YSCALE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glPopMatrix</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">glRotatef</span><span class="p">((</span><span class="n">GLfloat</span><span class="p">)</span> <span class="n">rightLowerHandAngle</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glTranslatef</span><span class="p">(</span><span class="n">GLOBAL_SIZE</span> <span class="o">*</span> <span class="n">HAND_XSCALE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glPushMatrix</span><span class="p">();</span>
</span><span class='line'>                <span class="n">glScalef</span><span class="p">(</span><span class="n">HAND_XSCALE</span><span class="p">,</span> <span class="n">HAND_YSCALE</span><span class="p">,</span> <span class="n">HAND_ZSCALE</span><span class="p">);</span>
</span><span class='line'>                <span class="n">glutSolidCube</span><span class="p">(</span><span class="n">GLOBAL_SIZE</span><span class="p">);</span>
</span><span class='line'>            <span class="n">glPopMatrix</span><span class="p">();</span>
</span><span class='line'>        <span class="n">glPopMatrix</span><span class="p">();</span>
</span><span class='line'>    <span class="n">glPopMatrix</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">glFlush</span><span class="p">();</span> <span class="c1">// 让OpenGL立即显示</span>
</span><span class='line'>    <span class="n">glutSwapBuffers</span><span class="p">();</span> <span class="c1">// 切换到另一个缓冲区（打开了GLUT_DOUBLE的所谓双缓冲）</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>成果</h1>

<p><embed src="http://player.youku.com/player.php/sid/XNDc2NzA4NjM2/v.swf" allowFullScreen="true" quality="high" width="480" height="400" align="middle" allowScriptAccess="always" type="application/x-shockwave-flash"></embed></p>

<h1>小结</h1>

<p>这次实验是所谓的「一个星期学会OpenGL」，事实证明没有东西是不可能的，只要你想做！</p>

<p>而这次的制作虚拟人走动确实挺有趣的，比以前的项目做的那些无聊的东西好多了哈。</p>
</div>

</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	<a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
	
	
	<a class="addthis_button_tweet"></a>
	
	
	<a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
	
	<a class="addthis_counter addthis_pill_style"></a>
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>



<section id="comment">
    <h1 class="title">Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>
</div>
			</div>
			<footer id="footer" class="inner">Copyright &copy; 2012

    Yutang Chung


Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
			<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'sysuzonyitooblog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://zonyitoo.github.com/blog/2012/11/18/openglzhi-zuo-xu-ni-ren-yun-dong/';
        var disqus_url = 'http://zonyitoo.github.com/blog/2012/11/18/openglzhi-zuo-xu-ni-ren-yun-dong/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-36473925-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



		</div>
	</div>
</body>
</html>
